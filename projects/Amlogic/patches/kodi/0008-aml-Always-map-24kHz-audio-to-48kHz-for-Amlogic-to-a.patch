From d9141786c24d6f320d955793534cdd939445dad7 Mon Sep 17 00:00:00 2001
From: kszaq <kszaquitto@gmail.com>
Date: Wed, 5 Aug 2015 16:02:02 +0200
Subject: [PATCH] [aml] Always map 24kHz audio to 48kHz for Amlogic to avoid
 video/sound speed-up

---
 xbmc/cores/AudioEngine/Sinks/AESinkALSA.cpp | 10 ++++++++++
 1 file changed, 10 insertions(+)

diff --git a/xbmc/cores/AudioEngine/Sinks/AESinkALSA.cpp b/xbmc/cores/AudioEngine/Sinks/AESinkALSA.cpp
index df50940..2da1823 100644
--- a/xbmc/cores/AudioEngine/Sinks/AESinkALSA.cpp
+++ b/xbmc/cores/AudioEngine/Sinks/AESinkALSA.cpp
@@ -655,6 +655,16 @@ bool CAESinkALSA::InitializeHW(const ALSAConfig &inconfig, ALSAConfig &outconfig
   snd_pcm_hw_params_set_access(m_pcm, hw_params, SND_PCM_ACCESS_RW_INTERLEAVED);
 
   unsigned int sampleRate   = inconfig.sampleRate;
+#ifdef HAS_LIBAMCODEC
+  // Always map 24kHz audio to 48kHz to avoid video/sound speed-up
+  switch (sampleRate)
+  {
+  case 24000:
+    sampleRate = 48000;
+    break;
+  }
+#endif
+
   snd_pcm_hw_params_set_rate_near    (m_pcm, hw_params, &sampleRate, NULL);
 
   unsigned int channelCount = inconfig.channels;
-- 
1.8.3.1

